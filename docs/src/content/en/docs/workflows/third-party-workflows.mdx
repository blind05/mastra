---
title: "Third-party Workflow Engines | Workflows | Mastra Docs"
description: "Integrate Mastra workflows with third-party workflow engines like Inngest"
---

import { Tabs, Tab } from "@/components/tabs";
import { Callout } from "nextra/components";

# Third-party Workflow Engines

Mastra workflows can be integrated with third-party workflow engines to leverage their infrastructure, monitoring, and execution capabilities. This allows you to run Mastra workflows using platforms like Inngest's hosted infrastructure.

Currently supported workflow engines:

- **Inngest** - Developer platform for building and running background workflows

## Inngest

[Inngest](https://www.inngest.com/docs) is a developer platform for building and running background workflows, without managing infrastructure.

### How Inngest Works with Mastra

- **Workflow Alignment**: Mastra workflows (`createWorkflow` and `createStep`) map directly to Inngest's function/step model
- **Automatic Registration**: Each Mastra workflow becomes an Inngest function with a unique identifier
- **Step Mapping**: Individual workflow steps map to Inngest steps with the same execution logic
- **Bridging Systems**: The `serve` function from `@mastra/inngest` registers Mastra workflows as Inngest functions and handles event routing
- **Step Memoization**: Inngest executes workflows step-by-step, caching results for efficient retries and resumption
- **Control Flow Support**: Mastra features like loops, conditionals, and nested workflows work seamlessly with Inngest
- **Real-time Monitoring**: Built-in observability through Inngest's dashboard with step-level tracking
- **State Persistence**: Workflow state is tracked using Mastra storage and can be resumed as needed

### Setup

<Callout>
This guide assumes you're working with a Mastra project created using `npx create-mastra@latest`. If you haven't created a project yet, start with the [installation guide](/docs/getting-started/installation) to set up your Mastra project with the default weather workflow.
</Callout>

Install the required packages for Inngest integration:

<Tabs items={["npm", "pnpm", "yarn", "bun"]}>
  <Tab>
    ```bash copy
    npm install @mastra/inngest inngest
    ```
  </Tab>
  <Tab>
    ```bash copy
    pnpm add @mastra/inngest inngest
    ```
  </Tab>
  <Tab>
    ```bash copy
    yarn add @mastra/inngest inngest
    ```
  </Tab>
  <Tab>
    ```bash copy
    bun add @mastra/inngest inngest
    ```
  </Tab>
</Tabs>

### Building an Inngest Workflow

This guide shows how to integrate Inngest with your existing Mastra weather workflow.

#### Update Your Weather Workflow

Start with your existing `src/mastra/workflows/weather-workflow.ts` file and add the Inngest integration:

```ts {1-2,5-9,11} filename="src/mastra/workflows/weather-workflow.ts" showLineNumbers copy
import { init } from "@mastra/inngest";
import { Inngest } from "inngest";
import { z } from "zod";

// Export the inngest client for server configuration
export const inngest = new Inngest({
  id: "mastra", 
  isDev: process.env.NODE_ENV === "development",
});

const { createWorkflow, createStep, cloneWorkflow, cloneStep } = init(inngest);

// The rest of the weather workflow code...
```

You can now create steps, workflows, and clone them using the functions from `init` - `createStep`, `createWorkflow`, `cloneStep`, and `cloneWorkflow` - just as you would with the standard Mastra workflow functions, but they'll be Inngest-compatible.

#### Configure Mastra Server

Add the Inngest API route to your existing Mastra instance in `src/mastra/index.ts`:

```ts {6-7,19-26} filename="src/mastra/index.ts" showLineNumbers copy
import { Mastra } from "@mastra/core/mastra";
import { PinoLogger } from "@mastra/loggers";
import { LibSQLStore } from "@mastra/libsql";
import { weatherWorkflow } from "./workflows/weather-workflow";
import { weatherAgent } from "./agents/weather-agent";
import { serve as inngestServe } from "@mastra/inngest";
import { inngest } from "./workflows/weather-workflow";

export const mastra = new Mastra({
  workflows: { weatherWorkflow },
  agents: { weatherAgent },
  storage: new LibSQLStore({
    url: ":memory:",
  }),
  logger: new PinoLogger({
    name: "Mastra",
    level: "info",
  }),
  server: {
    host: "0.0.0.0",
    apiRoutes: [{
      path: "/api/inngest",
      method: "ALL",
      createHandler: async ({ mastra }) => inngestServe({ mastra, inngest }),
    }],
  },
});
```

Add these imports and the API route to your existing Mastra configuration. The `inngestServe` function automatically registers your Mastra workflows as Inngest functions.

#### Running the Workflow locally

> **Prerequisites:**
>
> - Docker installed and running
> - Mastra project set up
> - Dependencies installed (`npm install`)

1. Start the Mastra development server:

<Tabs items={["npm", "pnpm", "yarn", "bun"]}>
  <Tab>
    ```bash copy
    npm run dev
    ```
  </Tab>
  <Tab>
    ```bash copy
    pnpm dev
    ```
  </Tab>
  <Tab>
    ```bash copy
    yarn dev
    ```
  </Tab>
  <Tab>
    ```bash copy
    bun run dev
    ```
  </Tab>
</Tabs>

This starts the Mastra server on port 4111.
2. Start the Inngest Dev Server (via Docker)
   In a new terminal, run:

```sh copy
docker run --rm -p 8288:8288 \
  inngest/inngest \
  inngest dev -u http://host.docker.internal:4111/api/inngest
```

> **Note:** The URL after `-u` tells the Inngest dev server where to find your Mastra `/api/inngest` endpoint.

3. Open the Inngest Dashboard

- Visit [http://localhost:8288](http://localhost:8288) in your browser.
- Go to the **Apps** section in the sidebar.
- You should see your Mastra workflow registered.
  ![Inngest Dashboard](/inngest-apps-dashboard.png)

4. Invoke the Weather Workflow

- Go to the **Functions** section in the sidebar.
- Select `workflow.weather-workflow`.
- Click **Invoke** and use the following input:

```json copy
{
  "data": {
    "inputData": {
      "city": "New York"
    }
  }
}
```

![Inngest Function](/inngest-function-dashboard.png)

5. **Monitor the Workflow Execution**

- Go to the **Runs** tab in the sidebar.
- Click on the latest run to see step-by-step execution progress.
  ![Inngest Function Run](/inngest-runs-dashboard.png)

#### Running the Workflow in Production

> **Prerequisites:**
>
> - Vercel account and Vercel CLI installed (`npm i -g vercel`)
> - Inngest account
> - Vercel token (recommended: set as environment variable)

1. Add Vercel Deployer to Mastra instance

```ts showLineNumbers copy filename="src/mastra/index.ts"
import { VercelDeployer } from "@mastra/deployer-vercel";

export const mastra = new Mastra({
  // ...other config
  deployer: new VercelDeployer({
    teamSlug: "your_team_slug",
    projectName: "your_project_name",
    // you can get your vercel token from the vercel dashboard by clicking on the user icon in the top right corner
    // and then clicking on "Account Settings" and then clicking on "Tokens" on the left sidebar.
    token: "your_vercel_token",
  }),
});
```

> **Note:** Set your Vercel token in your environment:
>
> ```sh copy
> export VERCEL_TOKEN=your_vercel_token
> ```

2. Build the mastra instance

```sh copy
npx mastra build
```

3. Deploy to Vercel

```sh copy
cd .mastra/output
vercel --prod
```

> **Tip:** If you haven't already, log in to Vercel CLI with `vercel login`.

4. Sync with Inngest Dashboard

- Go to the [Inngest dashboard](https://app.inngest.com/env/production/apps).
- Click **Sync new app with Vercel** and follow the instructions.
- You should see your Mastra workflow registered as an app.
  ![Inngest Dashboard](/inngest-apps-dashboard-prod.png)

5. Invoke the Weather Workflow

- In the **Functions** section, select `workflow.weather-workflow`.
- Click **All actions** (top right) > **Invoke**.
- Provide the following input:

```json copy
{
  "data": {
    "inputData": {
      "city": "San Francisco"
    }
  }
}
```

![Inngest Function Run](/inngest-function-dashboard-prod.png)

6. Monitor Execution

- Go to the **Runs** tab.
- Click the latest run to see step-by-step execution progress.
  ![Inngest Function Run](/inngest-runs-dashboard-prod.png)

### Advanced Usage: Adding Custom Inngest Functions

You can serve additional Inngest functions alongside your Mastra workflows by using the optional `functions` parameter in `inngestServe`.

#### Creating Custom Functions

First, create your custom Inngest functions:

```ts showLineNumbers copy filename="src/inngest/custom-functions.ts"
import { inngest } from "./inngest";

// Define custom Inngest functions
export const customEmailFunction = inngest.createFunction(
  { id: 'send-welcome-email' },
  { event: 'user/registered' },
  async ({ event }) => {
    // Custom email logic here
    console.log(`Sending welcome email to ${event.data.email}`);
    return { status: 'email_sent' };
  }
);

export const customWebhookFunction = inngest.createFunction(
  { id: 'process-webhook' },
  { event: 'webhook/received' },
  async ({ event }) => {
    // Custom webhook processing
    console.log(`Processing webhook: ${event.data.type}`);
    return { processed: true };
  }
);
```

#### Serving Custom Functions with Workflows

Update your Mastra configuration to include the custom functions:

```ts showLineNumbers copy filename="src/mastra/index.ts"
import { Mastra } from "@mastra/core/mastra";
import { serve as inngestServe } from "@mastra/inngest";
import { incrementWorkflow } from "./workflows";
import { inngest } from "./inngest";
import { customEmailFunction, customWebhookFunction } from "./inngest/custom-functions";

export const mastra = new Mastra({
  workflows: {
    incrementWorkflow,
  },
  server: {
    host: "0.0.0.0",
    apiRoutes: [
      {
        path: "/api/inngest",
        method: "ALL",
        createHandler: async ({ mastra }) => inngestServe({
          mastra,
          inngest,
          functions: [customEmailFunction, customWebhookFunction] // Add your custom functions
        }),
      },
    ],
  },
});
```

#### Function Registration

When you include custom functions:

1. **Mastra workflows** are automatically converted to Inngest functions with IDs like `workflow.${workflowId}`
2. **Custom functions** retain their specified IDs (e.g., `send-welcome-email`, `process-webhook`)
3. **All functions** are served together on the same `/api/inngest` endpoint

This allows you to combine Mastra's workflow orchestration with your existing Inngest functions seamlessly.
