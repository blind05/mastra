# AI SDK v5 Migration Guide

This guide covers Mastra-specific considerations when migrating from AI SDK v4 to v5.

## Official Migration Guide

**First, follow the comprehensive [AI SDK v5 Migration Guide](https://v5.ai-sdk.dev/docs/migration-guides/migration-guide-5-0)** for all core breaking changes, package updates, and API changes.

This guide covers only the Mastra-specific aspects of the migration.

## Overview

Migrating to AI SDK v5 with Mastra involves updating both your **backend** (Mastra server) and **frontend**:

- **Backend migration**: Update Mastra to handle v5 breaking changes while maintaining v4 compatibility for your frontend
- **Frontend migration**: Update your client code from AI SDK v4 to v5 following the official guide

Mastra provides compatibility mode to handle stream format conversion during the transition.

## Migration Strategy

1. **Upgrade backend**: Bump Mastra to the new alpha version and set `aiSdkCompat: 'v4'` on your Mastra instance
2. **Fix backend issues**: Update your backend code for v5 breaking changes, test that your frontend still works
3. **Upgrade frontend**: Set `aiSdkCompat: 'v5'` (or remove the config) and upgrade your frontend to use AI SDK v5

## Backend Configuration

Configure Mastra compatibility mode:

```typescript
import { Mastra } from '@mastra/core';

export const mastra = new Mastra({
  agents: { myAgent },
  
  // v4 compatibility mode - keeps frontend working during migration
  aiSdkCompat: 'v4',
  
  // Native v5 mode (default) - use after frontend is upgraded
  aiSdkCompat: 'v5',
});
```

**v4 compatibility mode:**
- Converts v5 streams to v4 format for existing frontends
- Allows gradual migration of frontend components
- Maintains backward compatibility during transition

